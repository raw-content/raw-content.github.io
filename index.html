<!DOCTYPE html>
<html lang="en">
<head>
<link rel="schema.dcterms" href="http://purl.org/dc/terms/">
<meta name="dcterms.rights" content="CC-BY-4.0">
<meta name="dcterms.rightsHolder" content="https://github.com/casperdcl">
<meta name="dcterms.dateCopyrighted" content="2026">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>raw-content</title>
</head>
<body>
<h1 id="dirname">.</h1>
<a id="up">..</a>
<div id="listing">Loading...</div>
<script>
var path = window.location.search.substring(1).split('/');
const owner = path.shift();
const repo = path.shift();
const branch = path.shift();
if (!owner || !repo || !branch) {
  document.getElementById('dirname').textContent = 'Invalid URL format';
  document.getElementById('listing').textContent = `Expected: ${window.location.host}?OWNER/REPO/BRANCH/path/to/directory`;
  throw new Error('Invalid URL format');
}
document.getElementById('dirname').textContent = window.location.search.substring(1);
document.getElementById('up').href = window.location.href.split('/').slice(0, -1).join('/');
document.getElementsByTagName('title')[0].textContent = `${path.join('/') || '/'} | ${owner}/${repo}`;
var listing = document.getElementById('listing');

function traverse(tree, path) {
  if (path.length === 0) return Promise.resolve(tree);
  const next = path.shift();
  return fetch(tree.tree.find(x => x.path === next).url)
    .then(response => response.json())
    .then(subtree => traverse(subtree, path))
    .catch(error => { listing.textContent = 'Error loading directory: ' + error; });
}
fetch(`https://api.github.com/repos/${owner}/${repo}/git/trees/${branch}`)
  .then(response => response.json())
  .then(tree => {
    traverse(tree, path).then(dir => {
      listing.innerHTML = '<ul>' + dir.tree.map(
        x => `<li><a href="${
          x.type == 'tree' ? window.location.href : `https://raw.githubusercontent.com/${owner}/${repo}/refs/heads/${branch}/${
            window.location.search.substring(1).split('/').slice(3).join('/')
          }`
        }/${x.path}">${x.path}</a></li>`
      ).join('') + '</ul>';
    });
  })
  .catch(error => { listing.textContent = 'Error loading directory: ' + error; });
</script>
</body>
</html>
